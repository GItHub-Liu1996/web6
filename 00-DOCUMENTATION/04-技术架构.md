# GoChinaAdvisors (仮) - 项目架构总纲

> **⚠️ 重要提示**: 在阅读此架构文档之前，请务必先查阅 [开发总纲 - 核心开发细则](./00-DOCUMENTATION/03-开发总纲-核心开发细则.md)。该文档包含了项目开发的最高准则和强制执行规则，所有开发工作都必须严格遵循。

## 项目概述

### 项目目标
为外国用户在中国注册和运营公司提供一站式专业服务的权威内容与业务平台，通过高质量的博客内容获取有机流量，建立品牌权威性，推动业务获客。

### 核心价值主张
- **专业性**：提供准确、及时的中国公司注册信息
- **便利性**：简化复杂的注册流程
- **可信度**：通过深度内容建立行业权威地位
- **国际化**：面向全球用户的多语言支持

## 技术架构

### 技术栈选择

#### 前端框架：Next.js 15
**选择理由：**
- **SEO优化**：内置SSR/SSG支持，对博客内容SEO至关重要
- **性能优化**：自动代码分割、图片优化、字体优化
- **开发体验**：热重载、TypeScript支持、API路由
- **部署便利**：Vercel原生支持，但当前阶段本地开发

#### 类型系统：TypeScript
**选择理由：**
- **类型安全**：减少运行时错误，提高代码质量
- **开发效率**：更好的IDE支持和自动补全
- **团队协作**：清晰的接口定义，便于维护

#### 样式方案：Tailwind CSS
**选择理由：**
- **开发效率**：原子化CSS，快速构建UI
- **一致性**：设计系统内置，确保视觉统一
- **性能优化**：按需生成CSS，减少包体积
- **响应式**：移动优先的设计理念

### 项目结构

```
web6/
├── src/
│   ├── app/                    # Next.js 13+ App Router
│   │   ├── (routes)/          # 路由组
│   │   │   ├── blog/          # 博客相关页面
│   │   │   ├── services/      # 服务页面
│   │   │   └── about/         # 关于我们
│   │   ├── api/               # API路由
│   │   ├── globals.css        # 全局样式
│   │   ├── layout.tsx         # 根布局
│   │   └── page.tsx           # 首页
│   ├── components/            # 可复用组件
│   │   ├── ui/                # 基础UI组件
│   │   ├── blog/              # 博客专用组件
│   │   ├── forms/             # 表单组件
│   │   └── layout/            # 布局组件
│   ├── lib/                   # 工具函数和配置
│   │   ├── utils.ts           # 通用工具函数
│   │   ├── validations.ts     # 表单验证
│   │   └── constants.ts       # 常量定义
│   └── types/                 # TypeScript类型定义
├── content/                   # 内容管理（与src分离）
│   ├── blog/                 # 博客文章
│   ├── pages/                # 静态页面内容
│   └── translations/         # 多语言翻译文件
├── public/                   # 静态资源
├── docs/                     # 项目文档
└── tests/                    # 测试文件
```

## 架构决策记录 (ADR)

### ADR-001: 选择Next.js App Router
**日期：** 2024-01-XX
**状态：** 已接受

**背景：**
需要构建一个以博客为核心的营销网站，SEO和性能是关键要求。

**决策：**
使用Next.js 14的App Router架构。

**理由：**
1. **SEO优势**：内置SSR/SSG支持，对博客内容SEO至关重要
2. **性能优化**：自动代码分割、图片优化
3. **开发体验**：更好的文件系统路由和布局系统
4. **未来兼容**：App Router是Next.js的未来方向

**后果：**
- 需要学习新的路由系统
- 某些第三方库可能需要适配
- 但长期来看，性能和开发体验都会更好

### ADR-002: 内容管理策略
**日期：** 2024-01-XX
**状态：** 已接受

**背景：**
博客内容需要频繁更新，需要简单易用的内容管理方案。项目初期需要快速启动，同时为未来的规模化运营做好准备。

**决策：**
项目启动阶段，采用本地 MDX 文件 + Git 作为核心内容管理方案。所有博客和静态页面内容以 .mdx 格式存储在项目根目录的 /content 文件夹下。

**权衡分析 (Pros & Cons):**

| 优点 (Pros) | 缺点 (Cons) |
|-------------|-------------|
| **极致性能**：内容可被 Next.js 静态生成(SSG)，加载速度快 | **非技术人员不友好**：需要学习 Git 和 Markdown 语法 |
| **顶级开发体验**：在代码编辑器中直接编写，支持组件混排(MDX) | **扩展性限制**：缺乏 CMS 的高级功能（如定时发布、多人协作审批流） |
| **版本控制**：所有内容变更都可通过 Git 精确追踪 | **规模化挑战**：当文章数量巨大时，文件管理可能变得复杂 |
| **零成本**：无需任何额外的 CMS 服务费用 | |

**演进路径 (Evolution Path):**
为了确保内容引擎能够支撑未来的业务增长，我们规划了清晰的三阶段演进路径：

**阶段一 (当前): 本地 MDX + Git 工作流**
- 适用于开发者或技术娴熟的个人作为主要内容贡献者的阶段
- 所有内容以 .mdx 文件形式存储在 /content 目录
- 通过 Git 进行版本控制和协作

**阶段二 (团队协作期): 引入 Git-based Headless CMS**
- 当需要非技术背景的市场或运营团队成员管理内容时，我们将引入一个可视化的 Git-based CMS (如 Decap CMS)
- 优势：这套系统会在我们现有的 Git 和 MDX 文件之上，提供一个友好的网页编辑界面
- 既为非技术人员提供了便利，又保留了版本控制和静态生成的所有优点，技术改造成本极低

**阶段三 (大规模运营期): 迁移至 API-driven Headless CMS**
- 当内容运营变得极其复杂，需要高级的多人协作、内容审批流、A/B测试等功能时，我们将考虑将内容源迁移至专业的 API-driven Headless CMS (如 Sanity.io, Contentful 等)
- 这个阶段将提供企业级的内容管理能力，支持复杂的业务流程

**技术实现：**
- 使用 gray-matter 解析 MDX 文件的 Frontmatter
- 使用 remark + remark-html 将 MDX 转换为 HTML
- 支持 React 组件在 MDX 中的混排使用
- 通过 Next.js 的 SSG 功能实现静态生成

### ADR-003: 多语言支持策略
**日期：** 2024-01-XX
**状态：** 已接受

**背景：**
目标用户是外国用户，需要多语言支持。网站需要支持中文（主要）和英文，未来可能扩展到其他语言。需要与内容管理策略紧密配合，确保多语言内容的统一管理。

**决策：**
采用 next-intl 作为国际化框架，实现全站多语言支持。

**具体实施方案:**

**1. 路由策略**
- 采用子路径路由 (`/en`, `/zh`, etc.) 来区分语言版本，这对 SEO 最友好
- 默认语言：中文（zh）作为默认语言，根路径 `/` 指向中文版本
- 语言切换：通过 URL 参数或语言选择器实现

**2. UI 文本翻译**
- 网站界面、导航、表单等固定文本，使用 next-intl 的标准 JSON 文件进行管理
- 存放于 `/content/translations` 目录下，按语言分文件夹组织
- 支持嵌套的翻译键，便于组织复杂的翻译内容

**3. 内容翻译 (博客/页面)**
- 长篇内容（如博客文章）通过文件命名约定进行版本控制
- 示例：
  - 英文版: `some-post.en.mdx`
  - 中文版: `some-post.zh.mdx`
- 代码逻辑将根据当前路由的语言标识，自动读取对应语言版本的文件
- 支持内容级别的多语言管理，与 UI 翻译分离

**4. 技术实现细节**
- 使用 next-intl 的 App Router 集成
- 支持 TypeScript 类型安全，编译时检查翻译键
- 按需加载翻译文件，减少初始包体积
- 支持多语言 SEO，每个语言版本有独立的 URL
- 与内容管理策略无缝集成

**5. 未来演进**
- 我们选定的内容管理演进路径（无论是 Decap CMS 还是 Sanity.io）都对多语言内容管理提供了成熟的支持
- 确保了此策略的长期可行性和扩展性

**理由：**
1. **Next.js集成**：与Next.js App Router完美集成
2. **类型安全**：TypeScript支持，编译时检查翻译键
3. **性能优化**：按需加载翻译文件，减少初始包体积
4. **SEO友好**：支持多语言SEO，每个语言版本有独立的URL
5. **内容管理**：通过文件命名约定，便于内容团队管理多语言内容
6. **开发体验**：提供良好的开发工具和调试支持
7. **未来兼容**：与内容管理演进路径完美配合

**后果：**
- 需要维护多套翻译文件
- 内容团队需要学习文件命名约定
- 增加开发和维护成本
- 但能提供更好的用户体验和SEO效果
- 为未来的内容管理升级做好准备

### ADR-004: 营销技术栈与 Zoho 生态集成
**日期：** 2024-01-XX
**状态：** 已接受

**背景：**
项目需要实现从流量到客户的高效转化，并进行精细化运营。需要一个完整的营销技术栈来支持客户关系管理、邮件营销和用户行为分析。

**决策：**
深度集成 Zoho 生态系统，包括 Zoho CRM、Zoho Campaigns 和 Zoho PageSense。

**理由：**
1. **一站式解决方案**：Zoho 提供完整的营销技术栈，减少集成复杂度
2. **成本效益**：相比多个独立工具，Zoho 生态提供更好的价格优势
3. **数据统一**：所有营销数据在同一个生态系统中，便于分析和决策
4. **技术成熟**：Zoho 提供完善的 API 和开发者工具
5. **扩展性**：随着业务增长，可以轻松扩展到其他 Zoho 产品

**技术实现：**
- **CRM 集成**：通过 `/api/contact` 路由自动创建潜在客户
- **邮件营销**：通过 `/api/subscribe` 路由管理邮件列表
- **行为分析**：集成 PageSense 跟踪代码，提供热力图和会话录屏
- **安全考虑**：所有 API 密钥存储在环境变量中，使用 HTTPS 通信

**后果：**
- 需要学习 Zoho API 的使用方法
- 增加系统复杂度和维护成本
- 但能提供完整的营销自动化能力
- 为业务增长提供强有力的技术支撑

## 组件库与设计系统

### 设计令牌 (Design Tokens)

**颜色系统：**
- **主色调**：蓝色系 (#3b82f6) - 代表专业和信任
- **辅助色**：灰色系 (#6b7280) - 用于次要信息和背景
- **成功色**：绿色系 (#10b981) - 用于成功状态
- **警告色**：黄色系 (#f59e0b) - 用于警告信息
- **错误色**：红色系 (#ef4444) - 用于错误状态

**字体系统：**
- **主字体**：Geist Sans - 现代、清晰的无衬线字体
- **等宽字体**：Geist Mono - 用于代码和技术内容
- **字体大小**：12px, 14px, 16px, 18px, 20px, 24px, 32px, 48px
- **行高**：1.2 (标题), 1.5 (正文), 1.6 (长文本)

**间距系统：**
- **基础单位**：4px
- **间距等级**：4px, 8px, 12px, 16px, 20px, 24px, 32px, 40px, 48px, 64px
- **容器宽度**：320px (手机), 768px (平板), 1024px (桌面), 1280px (大屏)

**圆角系统：**
- **小圆角**：4px - 用于按钮、输入框
- **中圆角**：8px - 用于卡片、面板
- **大圆角**：12px - 用于模态框、大型组件

### 组件库架构

**基础组件 (UI Components)：**
- **Button**：多种变体和尺寸的按钮组件
- **Input**：表单输入组件，支持验证和错误状态
- **Card**：内容容器组件，支持多种样式变体
- **Modal**：模态框组件，用于弹窗和对话框
- **Toast**：消息提示组件，用于用户反馈

**布局组件 (Layout Components)：**
- **Header**：网站头部导航组件
- **Footer**：网站页脚组件
- **Container**：内容容器组件，响应式布局
- **Grid**：网格布局组件
- **Stack**：垂直/水平堆叠组件

**业务组件 (Business Components)：**
- **BlogCard**：博客文章卡片组件
- **ServiceCard**：服务介绍卡片组件
- **ContactForm**：联系表单组件
- **TestimonialCard**：客户评价卡片组件

### 单一事实来源原则

**Storybook 集成：**
- **组件文档**：所有基础组件必须在 Storybook 中展示
- **交互测试**：组件的各种状态和交互在 Storybook 中测试
- **设计规范**：设计令牌和组件变体在 Storybook 中统一管理
- **开发工具**：提供组件开发、测试和文档的完整工具链

**组件开发流程：**
1. 在 Storybook 中设计和测试组件
2. 编写组件代码和 JSDoc 注释
3. 添加单元测试
4. 更新 Storybook 文档
5. 通过 Pull Request 审查

### 设计系统维护

**版本控制：**
- 设计令牌变更需要更新文档
- 组件破坏性变更需要版本号升级
- 定期审查设计系统的一致性

**团队协作：**
- 设计师负责设计令牌定义
- 开发者负责组件实现
- 产品经理负责业务组件需求

## 依赖库记录

### 核心依赖库

#### next-intl (^3.0.0)
**用途：** 国际化支持
**选择理由：**
- 与Next.js App Router完美集成
- 支持TypeScript类型安全
- 按需加载翻译文件，性能优化
- 支持多语言SEO

#### gray-matter (^4.0.3)
**用途：** Markdown文件解析
**选择理由：**
- 轻量级，性能优秀
- 支持Frontmatter解析
- 与静态站点生成完美配合
- 简单易用的API

#### remark (^15.0.1) + remark-html (^16.0.1)
**用途：** Markdown转HTML
**选择理由：**
- 强大的Markdown处理能力
- 支持插件扩展
- 与Next.js SSG完美集成
- 活跃的社区支持

#### clsx (^2.0.0) + tailwind-merge (^2.0.0)
**用途：** CSS类名管理
**选择理由：**
- clsx：条件类名处理
- tailwind-merge：Tailwind CSS冲突解决
- 类型安全，TypeScript支持
- 性能优化，减少包体积

### 开发依赖库

#### @testing-library/react (^14.0.0) + @testing-library/jest-dom (^6.0.0)
**用途：** React组件测试
**选择理由：**
- 官方推荐的React测试方案
- 专注于用户行为测试
- 与Jest完美集成
- 支持无障碍测试

#### eslint-plugin-jsx-a11y (^6.8.0)
**用途：** 无障碍性检查
**选择理由：**
- 自动检查可访问性问题
- 符合WCAG标准
- 与ESLint集成
- 提高网站可访问性

#### prettier (^3.0.0)
**用途：** 代码格式化
**选择理由：**
- 统一的代码风格
- 与ESLint配合使用
- 支持多种文件格式
- 提高代码可读性

### 营销技术栈依赖库

#### zoho-crm-api (规划中)
**用途：** Zoho CRM API 集成
**选择理由：**
- 官方或社区维护的 Zoho CRM API 客户端
- 支持 TypeScript 类型定义
- 提供完整的 CRM 操作功能
- 支持认证和错误处理

#### zoho-campaigns-api (规划中)
**用途：** Zoho Campaigns API 集成
**选择理由：**
- 邮件营销自动化集成
- 支持订阅管理和列表操作
- 提供营销活动管理功能
- 支持 A/B 测试和性能分析

#### @zoho/pagesense (规划中)
**用途：** Zoho PageSense 用户行为分析
**选择理由：**
- 用户行为跟踪和分析
- 热力图和会话录屏功能
- 转化漏斗分析
- A/B 测试支持

### 版本管理策略

**生产依赖：** 使用精确版本号，确保生产环境稳定性
**开发依赖：** 使用范围版本号，允许安全更新

**更新策略：**
- 定期运行 `npm audit` 检查安全漏洞
- 使用 `npm outdated` 检查可更新依赖
- 重要更新前进行充分测试
- 记录重要依赖的更新原因和影响

## 核心功能模块

### 1. 博客系统
- **文章管理**：MDX格式，支持Frontmatter和React组件混排
- **分类标签**：按主题和地区分类
- **搜索功能**：全文搜索
- **相关推荐**：基于标签和分类的推荐
- **多语言支持**：通过文件命名约定管理多语言内容

### 2. 服务展示
- **服务介绍**：公司注册流程、费用、时间
- **案例展示**：成功案例和客户评价
- **在线咨询**：联系表单和即时聊天
- **服务预约**：在线预约系统

### 3. 用户认证与授权
- **管理员登录**：简单的管理员后台访问控制
- **角色管理**：区分管理员和普通用户权限
- **会话管理**：安全的用户会话处理
- **技术选型**：初步考虑使用 NextAuth.js

### 4. 用户交互
- **联系表单**：多步骤表单，收集用户需求
- **资源下载**：白皮书、指南等营销材料
- **邮件订阅**：Newsletter订阅
- **在线咨询**：实时聊天功能

### 5. 营销技术栈与 Zoho 生态集成
为实现从流量到客户的高效转化，并进行精细化运营，本项目将深度集成 Zoho 的生态系统。

#### 5.1 客户关系管理 (CRM): Zoho CRM

**集成目标：**
所有通过网站联系表单提交的潜在客户信息，都必须被自动创建为 Zoho CRM 中的"潜在客户 (Lead)"或"联系人 (Contact)"。

**技术实现：**
- 前端的联系表单将数据提交到一个服务端的 Next.js API 路由 (例如 `/api/contact`)
- 该 API 路由在后端服务器上，使用官方或社区提供的 Zoho CRM API 客户端，安全地调用接口，将数据写入 Zoho CRM
- 支持数据映射和字段转换，确保网站表单数据正确映射到 CRM 字段

**安全注意：**
- Zoho API 的认证密钥严禁存储在前端代码中
- 必须作为环境变量安全地存放在 Vercel 后端
- 使用 HTTPS 进行所有 API 通信
- 实施适当的错误处理和重试机制

#### 5.2 邮件营销: Zoho Campaigns / Marketing Automation

**集成目标：**
网站上的"邮件订阅 (Newsletter)"表单，必须将订阅者的邮箱地址添加到 Zoho Campaigns (或你使用的其他 Zoho 营销工具) 的指定邮件列表中。

**技术实现：**
- 与 CRM 集成类似，通过一个专门的 API 路由 (`/api/subscribe`) 在后端调用 Zoho 的 API 来完成操作
- 支持订阅确认和退订功能
- 集成邮件模板和自动化流程
- 支持分段营销和个性化内容

**功能特性：**
- 自动邮件序列
- 行为触发邮件
- A/B 测试支持
- 邮件性能分析

#### 5.3 用户行为分析: Zoho PageSense

**集成目标：**
为了理解用户如何与我们的网站和博客内容互动，优化转化路径，我们将使用 Zoho PageSense。

**技术实现：**
- 在 Next.js 的根布局文件 (`src/app/layout.tsx`) 中，集成 Zoho PageSense 的跟踪代码片段
- 配置自定义事件跟踪，监控关键用户行为
- 设置转化漏斗分析，跟踪从访问到咨询的完整路径

**应用功能：**
- **热力图 (Heatmaps)**：分析用户点击和滚动行为，优化页面布局
- **会话录屏 (Session Recordings)**：观察用户真实使用过程，发现 UX 问题
- **转化分析**：跟踪关键转化点，优化转化率
- **A/B 测试**：对关键转化页面（如服务介绍页、联系表单页）进行优化实验
- **用户旅程分析**：理解用户从访问到转化的完整路径

#### 5.4 集成架构设计

**数据流设计：**
```
用户行为 → PageSense 分析 → 数据洞察
用户提交 → API 路由 → Zoho CRM → 销售跟进
邮件订阅 → API 路由 → Zoho Campaigns → 营销自动化
```

**API 路由设计：**
- `/api/contact` - 联系表单提交，创建 CRM 潜在客户
- `/api/subscribe` - 邮件订阅，添加到营销列表
- `/api/analytics` - 自定义事件跟踪
- `/api/webhook` - Zoho 系统回调处理

**环境变量配置：**
```env
# Zoho CRM
ZOHO_CRM_CLIENT_ID=your_client_id
ZOHO_CRM_CLIENT_SECRET=your_client_secret
ZOHO_CRM_REFRESH_TOKEN=your_refresh_token
ZOHO_CRM_ORG_ID=your_org_id

# Zoho Campaigns
ZOHO_CAMPAIGNS_API_KEY=your_api_key
ZOHO_CAMPAIGNS_LIST_ID=your_list_id

# Zoho PageSense
ZOHO_PAGESENSE_TRACKING_ID=your_tracking_id
```

**错误处理和监控：**
- 实施完整的错误处理机制
- 记录所有 API 调用日志
- 设置监控和告警系统
- 实施数据备份和恢复策略

## 性能优化策略

### 1. 图片优化
- 使用Next.js Image组件
- WebP格式优先
- 响应式图片加载

### 2. 代码分割
- 路由级别的代码分割
- 组件级别的懒加载
- 第三方库按需加载

### 3. 缓存策略
- 静态页面缓存
- API响应缓存
- 图片资源缓存

## SEO策略

### 1. 技术SEO
- 语义化HTML结构
- 结构化数据标记
- 站点地图生成
- robots.txt配置

### 2. 内容SEO
- 关键词研究和优化
- 内部链接策略
- 内容更新频率
- 长尾关键词布局

## 安全考虑

### 1. 数据保护
- 表单数据验证
- XSS防护
- CSRF保护

### 2. 隐私合规
- GDPR合规
- Cookie政策
- 数据收集透明度

## 开发规范

### 1. 代码规范
- ESLint + Prettier
- TypeScript严格模式
- 组件JSDoc注释

### 2. Git工作流
- **功能分支开发**：每个功能在独立分支开发
- **代码审查**：所有代码必须通过Pull Request审查
- **语义化提交信息**：遵循 Conventional Commits 规范

**Conventional Commits 规范示例：**
```
feat: add user login functionality
fix: correct blog post sorting issue
docs: update architecture document with i18n strategy
style: format code with prettier
refactor: extract common validation logic
test: add unit tests for Button component
chore: update dependencies to latest versions
```

**提交类型说明：**
- `feat`: 新功能
- `fix`: 错误修复
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

### 3. 测试策略
- 单元测试（Jest + React Testing Library）
- 集成测试
- E2E测试（Playwright）

## 部署和监控

### 1. 部署策略
- 本地开发环境
- 暂存环境（未来）
- 生产环境（未来）

### 2. 监控指标
- 页面加载速度
- 用户交互指标
- 错误监控
- SEO排名监控

## 未来扩展计划

### 1. 功能扩展
- 在线支付集成
- 客户管理系统
- 多语言内容管理
- 移动端APP

### 2. 技术升级
- 微服务架构
- 数据库集成
- 实时通信功能
- AI内容生成

---

**文档维护：**
本文档将随着项目发展持续更新，记录重要的架构决策和技术选择。
